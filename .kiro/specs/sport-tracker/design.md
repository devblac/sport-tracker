# Documento de Dise√±o - App de Fitness Gamificada PWA

## Overview

Esta PWA de fitness gamificada combina el seguimiento tradicional de entrenamientos con elementos sociales y de gamificaci√≥n avanzados. La aplicaci√≥n est√° dise√±ada con arquitectura offline-first, optimizada para m√≥viles pero accesible desde cualquier dispositivo, con un sistema de roles robusto que soporta desde usuarios invitados hasta personal trainers y administradores.

### Principios de Dise√±o

- **Mobile-First**: Dise√±o prioritario para dispositivos m√≥viles con adaptaci√≥n responsive
- **Offline-First**: Funcionalidad completa sin conexi√≥n a internet
- **Performance-First**: Carga r√°pida, lazy loading y optimizaciones agresivas
- **Gamification-First**: Elementos de juego integrados naturalmente en cada interacci√≥n
- **Social-First**: Funcionalidades sociales que fomentan engagement y viralidad

## Arquitectura

### Arquitectura General del Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Frontend PWA                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  UI Layer (React/Vue + PWA Shell)                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Mobile-First Components                               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Responsive Design System                              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Offline UI States                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Business Logic Layer                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Workout Engine                                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Gamification Engine                                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Social Engine                                         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ AI Recommendation Engine                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Data Layer                                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Local Storage (IndexedDB)                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Cache Management                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Sync Queue                                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Service Worker                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Backend API                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  API Gateway + Load Balancer                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Microservices Architecture                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Auth Service (JWT + OAuth)                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ User Management Service                              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Workout Service                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Social Service                                       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Gamification Service                                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Content Service (Exercises)                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Analytics Service                                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Notification Service                                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Payment Service                                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Data Layer                                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ PostgreSQL (Primary Database)                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Redis (Cache + Sessions)                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ S3 (Media Storage)                                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ ElasticSearch (Analytics)                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Arquitectura Frontend (PWA)

#### Estructura de Capas

**1. Presentation Layer**

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # Design system components
‚îÇ   ‚îú‚îÄ‚îÄ workout/           # Workout-specific components
‚îÇ   ‚îú‚îÄ‚îÄ social/            # Social features components
‚îÇ   ‚îú‚îÄ‚îÄ gamification/      # XP, achievements, streaks
‚îÇ   ‚îî‚îÄ‚îÄ shared/            # Reusable components
‚îú‚îÄ‚îÄ pages/                 # Route-based page components
‚îú‚îÄ‚îÄ layouts/               # Layout wrappers
‚îî‚îÄ‚îÄ hooks/                 # Custom React hooks
```

**2. Business Logic Layer**

```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ WorkoutEngine.ts   # Core workout logic
‚îÇ   ‚îú‚îÄ‚îÄ GamificationEngine.ts # XP, achievements, streaks
‚îÇ   ‚îú‚îÄ‚îÄ SocialEngine.ts    # Friends, feed, sharing
‚îÇ   ‚îú‚îÄ‚îÄ SyncEngine.ts      # Offline/online sync
‚îÇ   ‚îî‚îÄ‚îÄ AIEngine.ts        # Recommendations
‚îú‚îÄ‚îÄ stores/                # State management (Zustand/Redux)
‚îî‚îÄ‚îÄ utils/                 # Helper functions
```

**3. Data Layer**

```
src/
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ IndexedDBManager.ts # Local database
‚îÇ   ‚îú‚îÄ‚îÄ CacheManager.ts     # Intelligent caching
‚îÇ   ‚îî‚îÄ‚îÄ SyncQueue.ts        # Offline operations queue
‚îú‚îÄ‚îÄ api/                    # API client layer
‚îî‚îÄ‚îÄ types/                  # TypeScript definitions
```

## Componentes y Interfaces

### Navegaci√≥n Mobile-First

#### Bottom Navigation (5 Secciones Principales)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Main Content Area                        ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üè†     üìä     üí™     üë•     üë§                            ‚îÇ
‚îÇ Home  Progress Workout Social Profile                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**1. Home (üè†)**

- Dashboard con streak actual
- Quick start workout
- Feed de gym friends (√∫ltimas 3 actividades)
- Pr√≥ximo challenge/achievement
- Weather-based workout suggestions

**2. Progress (üìä)**

- Gr√°ficos de progreso personal
- Personal records timeline
- Percentiles globales
- Achievement gallery
- XP y nivel actual

**3. Workout (üí™)** - Centro de la app

- Active workout player
- Workout templates
- Exercise database browser
- Quick workout creator
- Timer y rest periods

**4. Social (üë•)**

- Gym friends feed completo
- Challenges activos
- Leaderboards
- Mentorship connections
- Content sharing hub

**5. Profile (üë§)**

- Configuraci√≥n personal
- Theme dark/light toggle
- Privacy settings
- Premium upgrade CTA
- Add gym friends
- Mentor/trainer options

### Componentes Core del Sistema

#### 1. Workout Engine Components

```typescript
// Workout Player - Componente central durante entrenamientos
interface WorkoutPlayerProps {
  workout: Workout;
  onSetComplete: (setData: SetData) => void;
  onWorkoutComplete: (summary: WorkoutSummary) => void;
}

// Set Logger - Registro de series con historial
interface SetLoggerProps {
  exercise: Exercise;
  previousSets?: SetData[]; // Mostrar datos hist√≥ricos
  onSetLog: (set: SetData) => void;
  setTypes: ["normal", "failure", "dropset", "warmup"];
}

// Rest Timer - Cron√≥metro autom√°tico entre sets
interface RestTimerProps {
  duration: number;
  autoStart: boolean;
  onComplete: () => void;
  onSkip: () => void;
}
```

#### 2. Exercise Detail Components

```typescript
// Exercise Detail View con 4 pesta√±as
interface ExerciseDetailProps {
  exercise: Exercise;
  userHistory: ExerciseHistory[];
  personalRecords: PersonalRecord[];
}

// Pesta√±as del detalle
interface ExerciseTabsProps {
  tabs: {
    about: ExerciseAboutTab; // GIF + instrucciones
    history: ExerciseHistoryTab; // Historial completo
    charts: ExerciseChartsTab; // Gr√°ficos de progreso
    records: ExerciseRecordsTab; // PRs + records history
  };
}
```

#### 3. Gamification Components

```typescript
// XP Progress Bar - Barra de experiencia
interface XPProgressProps {
  currentXP: number;
  levelXP: number;
  level: number;
  showAnimation: boolean;
}

// Achievement Card - Tarjetas de logros
interface AchievementCardProps {
  achievement: Achievement;
  progress?: number;
  unlocked: boolean;
  rarity: "common" | "rare" | "epic" | "legendary";
}

// Streak Display - Mostrar racha actual
interface StreakDisplayProps {
  currentStreak: number;
  scheduledDays: string[]; // ['monday', 'thursday']
  compensationDays?: string[];
  sickDaysUsed: number;
  maxSickDays: number;
}
```

#### 4. Social Components

```typescript
// Gym Friend Card - Tarjeta de amigo
interface GymFriendCardProps {
  friend: User;
  lastWorkout?: Date;
  currentStreak: number;
  mutualFriends?: number;
  onMessage: () => void;
}

// Social Feed Item - Item del feed social
interface SocialFeedItemProps {
  post: SocialPost;
  onLike: () => void;
  onComment: () => void;
  onShare: () => void;
}

// Challenge Card - Tarjeta de desaf√≠o
interface ChallengeCardProps {
  challenge: Challenge;
  userProgress: number;
  leaderboard: ChallengeParticipant[];
  onJoin: () => void;
}
```

## Modelos de Datos

### Modelos Core

```typescript
// Usuario con roles
interface User {
  id: string;
  email: string;
  username: string;
  role: "guest" | "basic" | "premium" | "trainer" | "admin";
  profile: UserProfile;
  settings: UserSettings;
  gamification: UserGamification;
  created_at: Date;
}

interface UserProfile {
  display_name: string;
  avatar_url?: string;
  age?: number;
  weight?: number;
  height?: number;
  fitness_level: "beginner" | "intermediate" | "advanced";
  goals: string[];
  scheduled_days: string[]; // Para streaks inteligentes
}

interface UserGamification {
  level: number;
  total_xp: number;
  current_streak: number;
  best_streak: number;
  sick_days_used: number;
  last_sick_day_reset: Date;
  achievements_unlocked: string[];
}

// Ejercicio con informaci√≥n completa
interface Exercise {
  id: string;
  name: string;
  type: "machine" | "dumbbell" | "barbell";
  category: string;
  body_parts: string[];
  muscle_groups: string[];
  equipment: string;
  difficulty_level: 1 | 2 | 3 | 4 | 5;
  instructions: string;
  gif_url?: string;
  muscle_diagram_url?: string;
  created_at: Date;
  updated_at: Date;
}

// Workout con flexibilidad de templates
interface Workout {
  id: string;
  user_id: string;
  name: string;
  exercises: WorkoutExercise[];
  is_template: boolean;
  is_completed: boolean;
  template_id?: string; // Si viene de template
  started_at?: Date;
  completed_at?: Date;
  duration?: number;
  total_volume: number;
  notes?: string;
}

interface WorkoutExercise {
  exercise_id: string;
  order: number;
  sets: SetData[];
  rest_time: number;
  notes?: string;
}

interface SetData {
  weight: number;
  reps: number;
  rpe?: number;
  type: "normal" | "failure" | "dropset" | "warmup";
  completed: boolean;
  completed_at?: Date;
}
```

### Modelos de Gamificaci√≥n

```typescript
// Sistema de achievements
interface Achievement {
  id: string;
  name: string;
  description: string;
  icon: string;
  category: "strength" | "consistency" | "social" | "milestone";
  rarity: "common" | "rare" | "epic" | "legendary";
  requirements: AchievementRequirement[];
  xp_reward: number;
  unlock_content?: string; // Contenido que desbloquea
}

interface AchievementRequirement {
  type: "workout_count" | "streak_days" | "weight_lifted" | "social_action";
  target_value: number;
  timeframe?: "daily" | "weekly" | "monthly" | "all_time";
}

// Sistema de challenges
interface Challenge {
  id: string;
  name: string;
  description: string;
  type: "individual" | "group" | "global";
  category: "strength" | "consistency" | "volume";
  start_date: Date;
  end_date: Date;
  requirements: ChallengeRequirement[];
  rewards: ChallengeReward[];
  participants_count: number;
  max_participants?: number;
}

interface ChallengeParticipant {
  user_id: string;
  progress: number;
  rank: number;
  joined_at: Date;
}
```

### Modelos Sociales

```typescript
// Sistema de gym friends
interface GymFriend {
  user_id: string;
  friend_id: string;
  status: "pending" | "accepted" | "blocked";
  created_at: Date;
  last_interaction?: Date;
}

// Feed social
interface SocialPost {
  id: string;
  user_id: string;
  type:
    | "workout_completed"
    | "achievement_unlocked"
    | "personal_record"
    | "challenge_completed";
  data: any; // Datos espec√≠ficos del tipo de post
  created_at: Date;
  likes_count: number;
  comments_count: number;
  shares_count: number;
  visibility: "public" | "friends" | "private";
}

// Sistema de mentorship
interface MentorshipConnection {
  mentor_id: string;
  mentee_id: string;
  status: "active" | "completed" | "paused";
  started_at: Date;
  goals: string[];
  progress_notes: MentorshipNote[];
}
```

## Gesti√≥n de Estado

### Arquitectura de Estado (Zustand)

```typescript
// Store principal de la aplicaci√≥n
interface AppStore {
  // Auth state
  user: User | null;
  isAuthenticated: boolean;

  // Workout state
  activeWorkout: Workout | null;
  workoutHistory: Workout[];
  templates: Workout[];

  // Exercise state
  exercises: Exercise[];
  exerciseHistory: Map<string, ExerciseHistory[]>;

  // Social state
  gymFriends: GymFriend[];
  socialFeed: SocialPost[];

  // Gamification state
  userStats: UserStats;
  achievements: Achievement[];
  activeChallenges: Challenge[];

  // UI state
  theme: "light" | "dark";
  activeTab: string;
  isOffline: boolean;
  syncStatus: "idle" | "syncing" | "error";
}

// Actions organizadas por dominio
interface AppActions {
  // Auth actions
  login: (credentials: LoginCredentials) => Promise<void>;
  logout: () => void;

  // Workout actions
  startWorkout: (template?: Workout) => void;
  logSet: (exerciseId: string, setData: SetData) => void;
  completeWorkout: () => Promise<void>;

  // Social actions
  addGymFriend: (username: string) => Promise<void>;
  likePost: (postId: string) => void;

  // Sync actions
  syncData: () => Promise<void>;
  queueOfflineAction: (action: OfflineAction) => void;
}
```

## Manejo de Errores

### Estrategia de Error Handling

```typescript
// Error boundaries por dominio
interface ErrorBoundaryStrategy {
  workout: {
    // Errores durante workout no deben perder progreso
    fallback: "save-and-retry";
    recovery: "auto-save-local";
  };

  social: {
    // Errores sociales no afectan funcionalidad core
    fallback: "graceful-degradation";
    recovery: "queue-for-retry";
  };

  sync: {
    // Errores de sync se manejan en background
    fallback: "offline-mode";
    recovery: "exponential-backoff";
  };
}

// Tipos de errores espec√≠ficos
enum AppErrorType {
  NETWORK_ERROR = "network_error",
  SYNC_CONFLICT = "sync_conflict",
  WORKOUT_DATA_LOSS = "workout_data_loss",
  AUTH_EXPIRED = "auth_expired",
  STORAGE_FULL = "storage_full",
  PERMISSION_DENIED = "permission_denied",
}
```

## Estrategia de Testing

### Pir√°mide de Testing

```
                    E2E Tests (10%)
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ Critical Flows  ‚îÇ
                 ‚îÇ - Login/Signup  ‚îÇ
                 ‚îÇ - Complete WO   ‚îÇ
                 ‚îÇ - Social Share  ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

              Integration Tests (20%)
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ Component Integration   ‚îÇ
           ‚îÇ - Workout Player       ‚îÇ
           ‚îÇ - Exercise Detail      ‚îÇ
           ‚îÇ - Social Feed          ‚îÇ
           ‚îÇ - Offline Sync         ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

         Unit Tests (70%)
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Business Logic & Utils          ‚îÇ
    ‚îÇ - Workout calculations          ‚îÇ
    ‚îÇ - XP/Achievement logic          ‚îÇ
    ‚îÇ - Data transformations          ‚îÇ
    ‚îÇ - Validation functions          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Testing por Funcionalidad

**Workout Engine Testing**

- C√°lculos de volumen y 1RM
- L√≥gica de rest timers
- Validaci√≥n de datos de sets
- Persistencia offline

**Gamification Testing**

- C√°lculo de XP por actividades
- L√≥gica de achievements
- Sistema de streaks inteligentes
- Validaci√≥n de challenges

**Social Engine Testing**

- Algoritmo de feed
- Sistema de notificaciones
- Validaci√≥n de privacidad
- Generaci√≥n de contenido compartible

## Priorizaci√≥n por Fases

### Fase 1 - MVP Core (8-10 semanas)

**Funcionalidades Esenciales:**

- Sistema de autenticaci√≥n (Guest, Basic, Premium)
- CRUD de workouts offline-first
- Base de datos de ejercicios con sync
- Workout player con timer y set logging
- Sistema b√°sico de templates
- Navegaci√≥n mobile-first
- PWA b√°sica con offline support

**Criterios de √âxito MVP:**

- Usuario puede crear cuenta y entrenar offline
- Datos se sincronizan cuando hay conexi√≥n
- App funciona como PWA instalable
- Performance: TTI < 3s, FCP < 1.5s

### Fase 2 - Gamificaci√≥n Core (6-8 semanas)

**Funcionalidades de Gamificaci√≥n:**

- Sistema de XP y niveles
- Achievements b√°sicos (consistencia, milestones)
- Streaks inteligentes con d√≠as programados
- Personal records tracking
- Progress charts b√°sicos
- Sistema de notificaciones

**Criterios de √âxito Gamificaci√≥n:**

- 80%+ de usuarios completan primer achievement
- Streak retention > 60% despu√©s de 7 d√≠as
- Engagement diario aumenta 40%

### Fase 3 - Social Core (6-8 semanas)

**Funcionalidades Sociales:**

- Sistema de gym friends
- Feed social b√°sico
- Sharing de workouts y achievements
- Sistema b√°sico de likes y comentarios
- Challenges grupales simples
- Notificaciones sociales

**Criterios de √âxito Social:**

- 50%+ de usuarios agregan al menos 1 gym friend
- 30%+ de workouts se comparten
- Viral coefficient > 0.3

### Fase 4 - Features Avanzadas (8-10 semanas)

**Funcionalidades Avanzadas:**

- AI recommendations
- Percentiles globales
- Sistema de mentorship
- Marketplace b√°sico para trainers
- Challenges complejos con leaderboards
- Analytics avanzados
- Content creation tools

### Fase 5 - Optimizaci√≥n y Escala (6-8 semanas)

**Optimizaciones:**

- Performance optimizations
- Advanced caching strategies
- Real-time features
- Advanced analytics
- A/B testing framework
- Monetization optimization

## Consideraciones de Performance

### M√©tricas Objetivo

```
Performance Targets:
‚îú‚îÄ‚îÄ Time to Interactive: < 3 segundos
‚îú‚îÄ‚îÄ First Contentful Paint: < 1.5 segundos
‚îú‚îÄ‚îÄ Largest Contentful Paint: < 2.5 segundos
‚îú‚îÄ‚îÄ Cumulative Layout Shift: < 0.1
‚îú‚îÄ‚îÄ First Input Delay: < 100ms
‚îî‚îÄ‚îÄ App Bundle Size: < 5MB total
```

### Estrategias de Optimizaci√≥n

**Code Splitting por Rutas:**

```typescript
// Lazy loading de rutas principales
const Home = lazy(() => import("./pages/Home"));
const Workout = lazy(() => import("./pages/Workout"));
const Social = lazy(() => import("./pages/Social"));
const Profile = lazy(() => import("./pages/Profile"));
```

**Caching Inteligente:**

```typescript
// Service Worker con estrategias espec√≠ficas
const cacheStrategies = {
  exercises: "cache-first", // Datos est√°ticos
  workouts: "network-first", // Datos din√°micos
  social: "stale-while-revalidate", // Balance
  media: "cache-first-with-refresh", // Im√°genes/videos
};
```

**Data Loading Optimization:**

```typescript
// Paginaci√≥n inteligente
const PAGINATION_SIZES = {
  workoutHistory: 20,
  socialFeed: 15,
  exerciseHistory: 50,
  achievements: 30,
};

// Prefetching predictivo
const prefetchStrategies = {
  nextWorkout: "on-idle",
  exerciseDetails: "on-hover",
  socialContent: "on-scroll-near",
};
```

Este dise√±o proporciona una base s√≥lida para desarrollar una PWA de fitness gamificada que rivalice con las mejores apps del mercado, con un enfoque claro en performance, engagement y viralidad.
