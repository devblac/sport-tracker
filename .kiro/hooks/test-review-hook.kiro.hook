{
  "enabled": true,
  "name": "MVP Test Review & Enhancement",
  "description": "Reviews tests to ensure they cover MVP core logic, use simple mocking, and follow testing principles for the Expo + Supabase refactor",
  "version": "2",
  "when": {
    "type": "userTriggered",
    "patterns": [
      "__tests__/**/*.{ts,tsx}",
      "**/*.test.{ts,tsx}",
      "**/*.spec.{ts,tsx}",
      "jest.config.js",
      "package.json"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "Review test files for MVP refactor compliance and quality:\n\n1. **Test Coverage Analysis** (Focus on Core Logic):\n   - XP calculation functions (lib/gamification.ts)\n   - Streak calculation logic (lib/streaks.ts)\n   - Achievement unlock conditions (lib/achievements.ts)\n   - Workout validation (Zod schemas)\n   - Offline sync queue operations (lib/offlineSync.ts)\n   - Date helpers and utilities\n\n2. **Test Scope** (MVP Only):\n   - ✅ Unit tests for business logic\n   - ✅ Integration tests for Supabase client\n   - ✅ Auth flow tests (signup, login, logout)\n   - ❌ NO E2E tests (manual testing for MVP)\n   - ❌ NO performance benchmarks\n   - ❌ NO test dashboards\n   - Target: 60%+ coverage for core logic\n\n3. **Mock Strategy** (Simple & Direct):\n   - Mock Supabase responses (not entire client)\n   - Mock SecureStore for token tests\n   - Mock NetInfo for offline tests\n   - Mock SQLite for sync tests\n   - NO complex mocking frameworks\n   - Keep mocks simple and readable\n\n4. **Test Structure**:\n   - Co-locate tests with source files\n   - Use descriptive test names\n   - Follow AAA pattern (Arrange, Act, Assert)\n   - Keep tests < 20 lines each\n   - One assertion per test when possible\n\n5. **Test Quality**:\n   - Test behavior, not implementation\n   - Focus on critical paths only\n   - Include edge cases for core logic\n   - Test error handling\n   - Fast tests (< 1 second each)\n\n6. **Specific Test Areas**:\n   - **Auth**: Signup, login, logout, token refresh\n   - **Workouts**: CRUD operations, offline queue\n   - **Gamification**: XP calculation, level progression, streaks\n   - **Social**: Friend requests, likes, leaderboard queries\n   - **Offline**: Queue operations, sync logic, conflict resolution\n   - **Validation**: Zod schema validation for all inputs\n\n7. **What NOT to Test**:\n   - UI components (manual testing)\n   - Supabase internals (trust the library)\n   - Third-party libraries\n   - Simple getters/setters\n   - Configuration files\n\n8. **Test Examples Needed**:\n   ```typescript\n   // Good: Test business logic\n   test('calculates XP with streak bonus', () => {\n     const xp = calculateWorkoutXP(60, 7); // 60 min, 7-day streak\n     expect(xp).toBe(72); // 60 * 1.2\n   });\n\n   // Good: Test error handling\n   test('handles invalid workout data', () => {\n     expect(() => validateWorkout({})).toThrow();\n   });\n\n   // Bad: Testing implementation details\n   test('calls supabase.from', () => { ... }); // Don't do this\n   ```\n\nProvide specific test recommendations focusing on simplicity and core logic coverage. Reference Jest + React Native Testing Library best practices."
  }
}
